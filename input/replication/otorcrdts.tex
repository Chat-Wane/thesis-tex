
\section{OT ou CRDTs?}
\label{repl:sec:otorcrdts}

La réplication optimiste permet de répliquer les données et d'effectuer des
modifications sur celle-ci directement, sans accord préalable d'un cœur
décisionnel. Les données sont deviennent à la fois plus disponibles et plus
réactives. Toutefois, les approches qui appartiennent à ce schéma de réplication
ont devoir de fournir des opérations de modification respectant la cohérence
forte à terme -- convergeant si possible vers un état
non-arbitraire. Malheureusement, cela peut s'avérer plus honéreux qu'il n'y
parait. Cette section décrit deux familles d'approches, respectivement les
approches à transformés opérationnels (OT -- cf. §\ref{repl:subsec:ot}) et les
approches à structure de données sans résolution de conflits (CRDTs --
cf. §\ref{repl:subsec:crdts}), ainsi que leurs limitations.

\subsection{Transformés opérationnels}
\label{repl:subsec:ot}

Les approches basées sur les transformés opérationnels~\cite{sun1998operational,
  sun2009contextbased} (OT) sont les plus anciennes et s'appliquent à un large
champs d'applications telles que l'édition de texte, l'édition d'images
etc. L'intuition est simple : Lors de la réception d'opérations modifiant notre
réplique, les arguments en sont ajustés afin qu'ils s'appliquent à l'état actuel
de la réplique, indépendemment des opérations effectuées entre temps.

\begin{figure}
  \centering
  \input{./input/replication/otexample.tex}
  \caption{\label{repl:fig:otexample} Exemple de transformé
    opérationnel. L'opération de suppression des 3 premiers caractères sur la
    réplique 3 ('RTY') est transformée afin de supprimer les 3 derniers caractères
    sur les autres répliques.}
\end{figure}

La figure~\ref{repl:fig:otexample} illustre le principe de fonctionnement des
approches basées sur les transformés opérationnels sur un scenario impliquant
une séquence répliquée. Dans cet exemple, les répliques sont toutes initialisées
avec la séquence 'RTY'. Ensuite, tandis que sur la réplique 1 trois caractères
supplémentaires sont insérés en tête pour obtenir 'QWERTY', sur la réplique 3
sont supprimés les trois caractères pour obtenir la séquence vide. Lors de la
reception de cette dernière opération de suppression au niveau de la réplique 1,
elle est interprétée comme une opération dont le contexte d'exécution n'avait
pas encore intégré les insertions -- et donc pas décalé les indices des
caractères. À ce titre, l'argument de l'opération se voit reattribué sa cible
aux trois caractères à partir du troisième caractère non-inclu. Réciproquement,
la réplique 3 intègre les insertions faites sur la réplique 1. Toutefois aucun
changement n'est nécessaire. À terme, les répliques convergent vers la séquence
'QWE'.

Dans le cadre de l'édition de texte, en plus des usuelles opérations d'insertion
et de suppression, OT founit des opérations ciblant les chaînes de caractères
telles que le déplacement, le couper -- coller, etc. Toutefois, l'analyse de
correction nécessite d'examiner chaque couple d'opérations ainsi que leurs
paramètres. En conséquence, lors de l'écriture du
papier~\cite{imine2003proving}, peu d'approches étaient réellement correctes.
Les approches OT peuvent être divisées en deux classes :
\begin{itemize}
\item [\textbf{Les approches décentralisées~\cite{sun2009contextbased} :}]
  Chaque serveur hébergeant une réplique est aussi client
  (cf. figure~\ref{repl:fig:otexample}). Chacune de ces entités doit être en
  mesure d'effectuer les transformations d'elle-même. Parmi les prérequis à
  cette tâche figure le méchanisme de détection de concurrence. En effet,
  retrouver le contexte d'exécution revient à transformer l'opération reçu
  contre toutes celles qui ont été intégrées sans avoir connaissance de
  celle-ci. Malheureusement, cela requière le transport d'un vecteur
  d'horloges~\cite{lamport1978time} -- ou consort -- avec chaque opération, qui
  sont ensuite sauvegardés dans un historique d'opérations. Que ce soit en terme
  de nombre d'utilisateurs ou en terme de nombre d'opérations, ces approches
  passent difficilement à l'échelle. Le temps d'exécution d'une opération locale
  est insignifiant, mais tout le reste des participants souffrent de quelques
  opérations concurrentes.

  Du reste, dans un environnement bien maitrisé, où les opérations arrivent très
  rapidement à un groupe raisonnable de participants, alors ces approches
  décentralisées deviennent inconcurrençables~\cite{mehdi2014merging}.
\item [\textbf{Les approches centralisées~\cite{nichols1995high} :}] Elles
  utilisent un serveur central afin de réarranger et diffuser les opérations de
  tous les participants à tous les participants. La transformation s'en trouve
  beaucoup moins coûteuse dès lors qu'un serveur s'interpose dans le
  processus. Toutefois, la topologie elle-même implique plusieurs défauts, à
  savoir, des problèmes concernant la confidentialité -- celui à qui appartient
  le serveur possède les données -- des problèmes concernant le passage à
  l'échelle -- le serveur supporte la charge de tous les participants -- des
  problèmes de tolérance aux pannes -- le serveur constitue un point individuel
  de défaillance.

  Malgré tous ces défauts, les approches centralisées sont les plus courantes
  aujourd'hui avec, notamment, les éditeurs collaboratifs bien connus tels que
  Google Docs (\REF) ou Etherpad (\REF).
\end{itemize}

\subsection{Structure de données sans résolutions de conflits}
\label{repl:subsec:crdts}

Un conflit est un cas où une valeur particulière est modifiée en même temps à
des endroits différents. Par exemple, la figure~\ref{repl:fig:optimisticexample}
montre un conflit sur le choix de la couleur. Les auteurs des modifications
ayant pris connaissance de ce conflit peuvent s'arranger afin de ne garder que
l'une des valeurs. Dans tous les cas, la résolution de conflits prend du temps,
est susceptible d'engendrer des erreurs, ou d'autres conflits en cascade.

Les structures de données sans résolution de
conflits~\cite{shapiro2011comprehensive} (CRDTs) appartiennent au schéma de
réplication optimiste. Comme leur dénomination l'indique, ces approches sont
basées sur des structures de données abstraites fournissant des opérations dont
les résultats commutent, et donc, ne générent pas de conflits, même en cas de
concurrence.  Il en existe deux familles équivalentes mais proposant un
compromis différent :
\begin{itemize}
\item [\textbf{Basée sur l'état :}] Lors d'une opération, l'état local change et
  est envoyé en totalité aux autres répliques qui fusionnent alors l'état reçu
  et leur état propre. L'envoi d'un état est honéreux et doit être effectué avec
  parcimonie. En revanche, puisqu'il est autonome (\emph{self-contained}), il ne
  nécessite aucune garantie particulière quant aux moyens de diffusion.
\item [\textbf{Basée sur les opérations :}] Lors d'une opération, son résultat
  seul est envoyé aux autres répliques où il est intégré. Les résultats sont
  envoyées les uns après les autres ce qui s'avère beaucoup moins coûteux que
  l'état complet. En revanche, cela requière une diffusion fiable, i.e., toutes
  les opérations doivent être inéluctablement reçues par toutes les serveurs
  hébergeant une réplique.
\end{itemize}

Des CRDTs existent pour différent types de structures tels que les compteurs,
les ensembles, les graphes etc.


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../../paper"
%%% End:
