
\section{LSEQ : une stratégie d'allocation polylogarithmique}
\label{lseq:sec:proposal}

\LSEQ (abréviation de \emph{polyLogarithimic SEQuence}) est une stratégie
d'allocation d'identifiants dont la taille est variable à la génération. Elle
alloue des identifiants avec une complexité en espace dont la borne supérieur
est de l'ordre du polylogarithme comparé au nombre d'insertions dans la
séquence.  Pour générer ses identifiants immuables et uniques, \LSEQ utilise
\begin{inparaenum}[(i)]
\item un arbre exponentiel comme structure de données,
\item deux sous-stratégies d'allocations avec objectifs antagonistes,
\item et un composant permettant de choisir la stratégie.
\end{inparaenum}

Puisqu'il est complexe de prédire le comportement d'édition des utilisateurs sur
un document, il est possible que \LSEQ alloue une série d'identifiants dont la
taille ne serait pas satisfaisante dans l'immédiat. Néanmoins, ce sacrifice
permet d'atteindre un niveau de l'arbre \LSEQ où les identifiants seront alloués 
efficacement jusqu'à compenser les pertes des identifiants alloués précédemment.

\subsection{Arbre exponentiel}

Un arbre est un graphe orienté, acyclique, et connexe. En d'autres termes, il
s'agit d'une structure dont les éléments sont liés entre eux par une relation de
parenté. Généralement, l'arité d'un arbre (i.e. le nombre de fils qu'un élément
peut posséder) est limitée par une constante. Par exemple, la
figure~\ref{fig:lseq:allocpathexample} présente des arbres d'arité
décimale. Ainsi, chaque élément possède au maximum 10 fils.

Un arbre exponentiel est un arbre dont l'arité augmente avec sa
profondeur. Ainsi, chaque élément peut posséder $c$-fois plus de fils que son
parent. Par exemple, avec un arbre exponentiel dont le facteur de croissance est
2, un élément dont l'arité maximum est $4$ voit chacun de ces fils posséder une
arité maximum de $8$, etc.  Un tel arbre de profondeur $k$ peut alors accueillir
:
\begin{equation}
  n = \sum\limits_{i=0}^{k} 2^{(i^2-i)/2}\,\,\, identifiants.
\end{equation}

Chaque lien de parenté est étiqueté et la série de ces étiquettes crée le chemin
vers un élément de la séquence. La représentation en mémoire de cette série
dépend de l'arité de l'arbre. Par exemple, les arbres d'arité décimale présents
dans la figure~\ref{fig:lseq:allocpathexample} ont besoin de $k*\log_2(10)$ bits
afin de représenter un chemin de profondeur $k$.  En revanche, les chemins \LSEQ
ont besoin d'un bit additionnel par niveau afin de refléter l'augmentation
d'arité de l'arbre. Pour représenter en mémoire un chemin de profondeur $k$, un
arbre exponentiel de facteur d'augmentation $2$ et dont la première profondeur
nécessite $b$ bits a besoin de :
\begin{equation}
  \sum\limits_{i=1}^{k}b+i = kb + k(k+1)/2 = O(k^2) \,\,\, bits.
\end{equation}

\begin{table}
  \centering
  \begin{tabular}{@{}lccc@{}}
    \toprule
    & Aléatoire & Monotone & Pire cas \\ \cmidrule{2-4}
    taille du chemin & $O(\sqrt{log\,n})$ & $O(log\,n)$ & $O(n)$ \\ \midrule
    taille binaire du chemin & \multicolumn{3}{c}{ $\sum\limits_{i=1}^{k}b+i =
      kb + k(k+1)/2 = O(k^2)$} \\ \midrule
    Complexité en espace & $O(log\,n)$ & $O((log\,n)^2)$ &
    $O(n^2)$ \\ \bottomrule
  \end{tabular}
  \caption{Complexité spatiale de \LSEQ avec $n$ le nombre d'opérations
    d'insertion effectuées sur la séquence; $k$ la profondeur d'un chemin;
    $b$ la taille binaire nécessaire pour représenter le chemin de profondeur 1.}
\end{table}

Une telle structure a l'avantage d'adapter sa consommation en mémoire à la
taille du document. En effet, commencer l'édition avec une petite arité reflète
la petite taille du document. Au contraire, lorsque le document devient plus
imposant, la profondeur de l'arbre \LSEQ augmente. Par conséquent, l'arité à
cette profondeur augmente elle aussi.

Nous nous intéressons maintenant à l'analyse en complexité spatiale lors de 3
types d'édition différents (pas nécessairement réaliste) afin de mettre en
évidence le comportement d'allocation de \LSEQ, à savoir:
\begin{asparadesc}
\item [Édition aléatoire:] insertions d'éléments à des positions aléatoires dans
  la séquence.
\item [Édition monotone:] insertions d'éléments à des positions adjacentes
  successivement. Par exemple, la figure~\ref{fig:lseq:allocpathexample} présente
  deux types d'édition monotone.
\item [Édition pire cas:] insertions d'éléments aux pires positions possibles
  résultant en une augmentation de la profondeur de l'arbre à chaque insertion.
\end{asparadesc}

\subsection{Sous-stratégies d'allocation}

\LSEQ utilise deux sous-stratégies d'allocation d'identifiants dont la finalité
est antagoniste. En effet, l'une de ces stratégies est adaptée à l'édition
monotone effectuée de gauche à droite, tandis que l'autre est adaptée à
l'édition monotone effectuée de droite à gauche. En terme de chemin dans
l'arbre, la première alloue la branche la plus à gauche en premier, la seconde
alloue la branche la plus à droite en premier, toutes deux dans le but de
laisser de l'espace (i.e. des chemins disponibles de même profondeur) pour les
futures insertions.

\begin{figure*}
  \centering
  \subfloat[Sous-stratégie adaptée à l'édition monotone de gauche à droite]
  [\label{fig:lseq:substrategiesexampleA}Sous-stratégie d'allocation adaptée à
  l'édition monotone de gauche à droite]
  {\input{input/lseq/substrategiesexampleA.tex}}
  \hspace{20pt}
  \subfloat[Sous-stratégie adaptée à l'édition monotone de droite à gauche]
  [\label{fig:lseq:substrategiesexampleB}Sous-stratégie d'allocation adaptée à
  l'édition monotone de droite à gauche]
  {\input{input/lseq/substrategiesexampleB.tex}}
  \caption{\label{fig:lseq:substrategiesexample}Les sous-stratégies employées
    par \LSEQ.}
\end{figure*}

La figure~\ref{fig:lseq:substrategiesexample} illustre le fonctionnement de
chacune de ces sous-stratégies. Dans les deux cas, l'utilisateur insère un
caractère à une position où les identifiants des éléments précédent et suivant
sont respectivement $[50]$ et $[51]$. L'espace d'allocation doit être agrandi
afin d'accueillir le nouvel identifiant. La
figure~\ref{fig:lseq:substrategiesexampleA} montre le cas de la stratégie
adaptée à l'édition de gauche à droite. Comme la profondeur du chemin a
augmenté, elle peut choisir d'allouer un chemin allant de $[50.1]$ à
$[50.99]$. Toutefois, afin de conserver de l'espace pour les futures insertions
supposées à droite du caractère actuel, elle restreint l'espace d'allocation à
$[50.1]$ à $[50.20]$ (la constante est fixée arbitrairement). Elle choisit
aléatoirement parmi cet espace et obtiens le chemin $[50.11]$. De manière
similaire, la figure~\ref{fig:lseq:substrategiesexampleB} montre le
fonctionnement de la stratégie adaptée à l'édition de droite à gauche. La
différence réside dans l'espace qui est restreint à partir de la borne
supérieur.  Ainsi, le choix de cette stratégie est effectué entre les bornes
$[50.80]$ et $[50.99]$ et, en définitive, se porte sur le chemin $[50.89]$.

\begin{algorithm}
  \input{input/lseq/substrategiesalgo.tex}
  \caption{\label{algo:lseq:substrategies}Sous-stratégies de \LSEQ.}
\end{algorithm}

Utilisées séparément, aucune de ces deux stratégies d'allocation ne parvient à
être satisfaisante. Les exemples des figure~\ref{fig:lseq:allocpathexample}
et~\ref{fig:lseq:allocation} extraits des motivations en sont la preuve. En
revanche, utilisées ensemble, elles pallient leurs faiblesses respectives.

\subsection{Choix de stratégie}

\LSEQ utilise deux sous-stratégies d'allocations dont l'objectif est
antagoniste. Pour chaque insertion d' éléments dans la séquence, il faut choisir
entre les deux sous-stratégies. De plus, lorsque plusieurs utilisateurs sont
impliqués dans l'édition, les choix peuvent avoir des conséquences dramatiques.
Par exemple, si dans l'exemple de la figure~\ref{fig:lseq:substrategiesexample}
deux utilisateurs insèrent un élément avec une stratégie différente, tout
l'espace qui se trouve entre les deux identifiants risque d'être perdu. Il est
donc essentiel que tous les possesseurs de la séquence répliquée fassent les
mêmes choix. De plus, afin de ne privilégier aucun type d'édition, il faut que
la fréquence de choix de chacun des deux types de stratégies soit égale.

Dans ce but, \LSEQ utilise une fonction de hachage initialisée par une graine
cachée dans le document, et qui, pour chaque profondeur de l'arbre, assigne une
sous-stratégie d'allocation particulière.

\begin{algorithm}
  \input{input/lseq/allocpathalgo.tex}
  \caption{\label{algo:lseq:allocpath}Allocation of the path.}
\end{algorithm}

\subsection{Synthèse}

\LSEQ utilise 3 composants afin de pouvoir allouer des identifiants dont la
complexité spatiale est, dans le cadre de l'édition collaborative, bornée par le
polylogarithme du nombre d'insertions effectués sur la séquence. Ces trois
composants sont
\begin{inparaenum}[(i)]
\item l'arbre exponentiel comme structure de données qui permet d'adapter la
  taille de l'identifiant afin de refléter la taille du document;
\item deux sous-stratégies d'allocations afin d'adapter le choix du chemin au
  comportement d'édition;
\item une fonction de hachage commune à toutes les répliques afin d'assigner à chaque
 profondeur de l'arbre une même sous-stratégie d'allocation.
\end{inparaenum}

\begin{figure*}
  \centering
  \subfloat {\input{input/lseq/lseqtreeexampleA.tex}}
  \hspace{10pt}
  \subfloat {\input{input/lseq/lseqtreeexampleB.tex}}
  \caption{\label{fig:lseq:lseqtreeexample} Arbre exponentiel de \LSEQ sur deux
    comportements d'édition antagonistes créant la séquence QWERTY. Dans cet
    exemple, La fonction $h$ de hachage défère l'allocation du chemin aux
    sous-stratégies d'allocation prévus pour l'édition en tête et l'édition en
    fin au premier et second niveau respectivement. De plus, l'arité de l'arbre
    est doublée à chaque niveau. Contrairement aux exemples de la
    figure~\ref{fig:lseq:allocpathexample}, la profondeur de ces arbres
    n'augmente pas de manière linéaire.}
\end{figure*}

La figure~\ref{fig:lseq:allocpathexample} présente les différents aspects de
\LSEQ au travers de sa représentation sous forme d'arbre. À gauche, la figure
présente les sous-stratégies d'allocation employées à chaque profondeur de
l'arbre. Ainsi, la fonction de hachage $h$ désigne la sous-stratégie adaptée à
l'édition monotone de gauche à droite pour le premier niveau, la sous-stratégie
adaptée à l'édition monotone de droite à gauche pour le second niveau, etc. À
droite, la figure présente l'arité maximum de l'arbre exponentiel aux différents
niveau de l'arbre. Ainsi, le premier élément de l'arbre peut acceuillir 32 fils,
eux-même peuvent en accueuillir 64, etc. La figure présente le résultat de
l'allocation effectuée par \LSEQ lors des comportements d'édition monotone
similaires à la figure~\ref{fig:lseq:allocpathexample}. Dans le cas de l'édition
montone de gauche à droite, \LSEQ doit insérer un premier élément entre les
chemins [0] et [32]. Comme l'espace est suffisant pour accueuillir le nouvel
élément à cette profondeur de l'arbre, \LSEQ en appelle à la fonction de hachage
$h$ afin de déférer l'allocation de l'identifiant à une sous-stratégie adaptée à
l'édition monotone. Ici, il s'agit de la sous-stratégie adaptée à l'édition de
gauche à droite qui cherche à conserver de l'espace à droite de la branche pour
les futures insertions. Ainsi, \LSEQ passe d'un espace d'allocation de [0]-[32]
à un espace d'allocation plus restreint [0]-[10]. Le chemin [1] est
aléatoirement choisit dans cet exemple. Ensuite, les caractères WERTY ont inséré
successivement et obtiennent respectivement les chemins [8], [9], [12], [17], et
[21]. Similairement à l'exemple de la figure~\ref{fig:lseq:allocpathexampleA},
l'arbre contenant la séquence partagée reste de profondeur 1. Dans le second
type de comportement d'édition, le premier caractère inséré est le Y, suivit du
T, du R, du E, du W, et enfin du Q. Lorsque \LSEQ doit allouer à ce premier
caractère un identifiant, il va le faire de manière identique au précédent
exemple. Toutefois, lorsque le caractère T est inséré, il n'y plus d'espace
entre les chemins [0] et [1]. La profondeur de l'arbre doit augmenter afin
d'accueillir le nouvel élément. Ce second niveau d'arbre peut accueillir deux
fois plus de fils que son parent, soit 64. L'allocation se fait donc entre les
bornes [0.0] et [0.64]. Puisque la fonction de hachage désigne la sous-stratégie
adaptée à l'édition monotone de droite à gauche, l'espace d'allocation est
restreint à [0.54]-[0.64]. Dans ce cas, le caractère T se voit attribué le
chemin [0.57]. Les caractères REWQ sont associées aux chemins [0.56], [0.53],
[0.48], et [0.44] respectivement. Dans ce cas, et contrairement à l'exemple de
la figure~\ref{fig:lseq:allocpathexampleB}, la profondeur de l'arbre n'atteint
que 2 niveaux.

% \begin{algorithm}
%   \input{input/lseq/allocdesalgo.tex}
%   \caption{\label{algo:allocdes}Allocation of the disambiguator.}
% \end{algorithm}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../../paper"
%%% End:
