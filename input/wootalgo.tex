
\small
\algrenewcommand{\algorithmiccomment}[1]{\hskip2em$\rhd$ #1}

\newcommand{\comment}[1]{$\rhd$ #1}


\algblockdefx[initially]{initially}{endInitially}
  [0] {\textbf{INITIALLY:}} 

\algblockdefx[local]{local}{endLocal}
  [0] {\textbf{LOCAL UPDATE:}}

\algblockdefx[received]{received}{endReceived}
  [0] {\textbf{RECEIVED UPDATE:}}

\algblockdefx[onInsert]{onLocal}{endOnLocal}
  [0] {\textbf{on} insert ($p \in \mathcal{I},\,\alpha \in \mathcal{A},\,
   q\in\mathcal{I}$):}
  [0] {\textbf{on} delete ($i \in \mathcal{I}$):} 

\algblockdefx[onRemote]{onRemote}{endOnRemote}
  [0] {\textbf{on} insert ($i\in\mathcal{I}$):\hfill\comment{once per 
  distinct triple in $\mathcal{I}$}}
  [0] {\textbf{on} delete ($i\in\mathcal{I}$):\hfill\comment{after the 
  remote $insert(i)$ is done}} 

\newcommand{\LINEFOR}[2]{%
  \algorithmicfor\ {#1}\ \algorithmicdo\ {#2} %
  }

\newcommand{\LINEIFTHEN}[2]{%
  \algorithmicif\ {#1}\ \algorithmicthen\ {#2} %
  }

\newcommand{\INDSTATE}[1][1]{\State\hspace{\algorithmicindent}}

\begin{algorithmic}[1]
  \Statex
  \initially
    \State $\mathcal{S} \leftarrow [\,]$; \hfill \comment{Replicated sequence}
    \State $\mathcal{D} \leftarrow \langle siteId,\, counter \rangle$;
    \hfill \comment{Disambiguator}
  \endInitially
  
  \local
    \onLocal
    \State $broadcast('insert',\, \langle p,\, inc(\mathcal{D}),\, \alpha,\,
    q \rangle)$;
    \endOnLocal
    \INDSTATE $broadcast('delete',\,i)$;
  \endLocal
  
  \received
    \onRemote
    \State \textbf{let} $p,\, d,\, \alpha,\, q \leftarrow i$;
    \hfill \comment{we assume that $p$ and $q$ arrived}
    \State \textbf{let} $index \leftarrow getIndex(p,\, i,\, q)$;
    \State $insert(\mathcal{S},\,index,\,i)$;
    \endOnRemote
    \INDSTATE $hide(\mathcal{S},\, i)$; \hfill \comment{Search the object and
      hide it}
  \endReceived
  
\end{algorithmic}
